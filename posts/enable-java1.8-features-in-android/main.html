<!DOCTYPE html><html lang="zh_CN"><head><meta charset="utf8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>在Android项目中使用java1.8的特性 | ylxdzsw's blog</title><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto+Mono' rel='stylesheet' type='text/css'><script src="/lib/zepto.js"></script><link rel="stylesheet" href="/lib/prism.css"/><script src="/lib/prism.js"></script><link rel="stylesheet" href="/nattoppet/vue.css"/><script src="/nattoppet/vue.js"></script></head><body><h2 id="-android-java1-8-">在Android项目中使用java1.8的特性</h2>
<p>Google在Android-N的SDK中支持了Java 1.8的部分特性，包括默认和静态接口方法、Lambda表达式(使用匿名类实现)以及重复注解等。</p>
<h3 id="1-android-studio-2-1-">1. 安装Android Studio 2.1+</h3>
<p>旧版本不支持Jack编译器，而这是启用Java 1.8特性所必需的，所以需要首先更新Android Studio到最新版本。</p>
<h3 id="2-build-gradle">2. 设置build.gradle</h3>
<pre><code class="lang-plain">android {
  ...
  compileSdkVersion &#39;android-N&#39;
  buildToolsVersion &#39;24 rc4&#39;

  defaultConfig {
    ...
    jackOptions {
      enabled true
    }
  }
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
}
</code></pre>
<p>主要是3点: 启用Jack编译器, 设置Java版本以及设置sdk版本。</p>
<h3 id="3-build-tools">3. 安装build-tools</h3>
<p>这是最让人困扰的一步，怀疑可能是Android Studio的BUG。</p>
<p>在做完上述的步骤之后，Android Studio会提示需要安装Build Tool 24.0.0 rc4，但是点击安装又显示<code>not avaliable</code>。自己打开SDK Manager安装后，Android Studio仍然显示找不到</p>
<pre><code>java.lang.IllegalStateException: failed to find Build Tools revision 24.0.0 rc4
</code></pre><p>经过查找之后，发现Android Studio始终是查找的<code>24.0.0-preview</code>文件夹，而SDK Manager安装的位置却是<code>24.0.0-rc4</code>，在网上搜索了一番，<a href="http://stackoverflow.com/questions/27272605/failed-to-find-build-tools-revision-21-1-1-sdk-up-to-date">最后在StackOverflow上找到了答案</a></p>
<blockquote>
<pre><code>$android list sdk -a
</code></pre><p>Which showed me the following list:</p>
<pre><code>1- Android SDK Tools, revision 24.0.2
2- Android SDK Platform-tools, revision 21
3- Android SDK Build-tools, revision 21.1.2
4- Android SDK Build-tools, revision 21.1.1
5- Android SDK Build-tools, revision 21.1
6- Android SDK Build-tools, revision 21.0.2
7- Android SDK Build-tools, revision 21.0.1
</code></pre><p>... and a great many more
Followed by the command:</p>
<pre><code>$ android update sdk -a -u -t 3
</code></pre><p>The &quot;3&quot; in the command refers the the index listed in the output of the first command.</p>
</blockquote>
<p>按照这个方法安装<code>Build-Tools 24 rc4</code>之后，<code>sdk/build-tools</code>中就出现了<code>24.0.0-preview</code>文件夹，再回到Android Studio已经可以正常编译了。</p>
</body></html>